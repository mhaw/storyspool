# Changelog

### Unreleased
- **feat(auth)**: Added client-side Firebase authentication logic (`app/static/js/auth.js`) to handle Google Sign-In/Sign-Out and update UI based on authentication state.
- **docs**: Added test account login instructions to `README.md`.
- **fix(auth)**: Removed hardcoded Firebase config; inject from env.
- **feat(security)**: Enabled CSP via Flask-Talisman in prod with Firebase/CDN allowlist.
- **feat(static)**: Long-cached static assets in prod.
- **chore(proxy)**: Added ProxyFix and sane cookie settings per env.
- **docs**: Added 2-minute MVP test instructions.
- **note(ci)**: Prior Cloud Build failures observed on 2025-08-28 (investigate later).
- **fix**: Resolved Cloud Run service startup failures by:
  - Excluding `.env` from Docker image via `.dockerignore`.
  - Guarding `load_dotenv()` in `wsgi.py` to prevent overriding Cloud Run environment variables.
  - Updating `app/config.py` for robust environment variable loading.
  - Building Docker image for `linux/amd64` platform.
  - Explicitly setting all required environment variables during deployment.
- **Hardened Cloud Run runtime service account**:
  - Created `storyspool-runner` service account with least-privilege roles (`roles/datastore.user`, `roles/storage.objectAdmin`, `roles/secretmanager.secretAccessor`, `roles/logging.logWriter`, `roles/monitoring.metricWriter`).
  - Switched Cloud Run service to use `storyspool-runner`.
  - Removed overly broad `roles/editor` from default Compute Engine service account.
- **Normalized Cloud Run service configuration**:
  - Cleared diagnostic command/args overrides.
  - Set reliability knobs (`min-instances`, `max-instances`, `concurrency`, `cpu`, `memory`, `timeout`).
- **feat(rss)**: Implemented robust, on-demand RSS 2.0 feed generation service with proper iTunes and Atom namespaces for podcast compatibility (`app/services/rss.py`).
- **feat(rss)**: Created a new endpoint at `/u/<uid>/feed.xml` to serve the personalized podcast feed with a 5-minute cache header (`app/routes.py`).
- **test(rss)**: Added both unit tests (`tests/test_rss.py`) to validate XML structure and an integration test (`tests/test_rss_integration.py`) to verify the entire feed generation pipeline.
- **feat(ui)**: Personalized "My Articles" page for logged-in users.
- **feat(ui)**: Added "Get My Podcast Feed" button with modal and copy-to-clipboard.
- **feat(ui)**: Responsive article list table (card-like on mobile).
- **feat(ui)**: Redesigned article actions with primary "Listen" button and dropdown for secondary actions.
- **feat(ui)**: New simple landing page for anonymous users.
- **test**: Added tests for new routing and UI features.
- **chore(tests)**: Added standard Flask `app` and `client` fixtures to `tests/conftest.py`.
- **fix(worker)**: Improved worker error handling with granular error statuses.
- **refactor**: Renamed `index.html` template to `articles.html`.
- **refactor**: Root route `/` now shows landing page for anonymous users and redirects to `/articles` for authenticated users.
- **fix(tests)**: Fixed multiple issues in the test suite.
- **fix(firestore)**: Updated Firestore security rules to require authentication.
- **fix(iam)**: Replaced `roles/storage.objectAdmin` with more restrictive roles.
- **fix(config)**: Replaced hardcoded project ID in `.firebaserc` with a placeholder.
- **fix(feed)**: Corrected feed title generation in `app/routes.py`.
- **fix(tests)**: Added `GCS_BUCKET_NAME` to test configuration.
